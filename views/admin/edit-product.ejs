<!-- views/admin/edit-product.ejs -->
<section class="admin-section">
    <div class="container">
      <div class="admin-header">
        <h1>Edit Product</h1>
        <a href="/admin/products" class="btn btn-outline">
          <i class="fas fa-arrow-left"></i> Back to Products
        </a>
      </div>
      
      <div class="admin-form-container">
        <form action="/admin/products/edit/<%= product._id %>?_method=PUT" method="POST" class="admin-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="name">Product Name</label>
              <input type="text" id="name" name="name" value="<%= product.name %>" required>
            </div>
            
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" name="category" required>
                <option value="giftcard" <%= product.category === 'giftcard' ? 'selected' : '' %>>Gift Card</option>
                <option value="account" <%= product.category === 'account' ? 'selected' : '' %>>Account</option>
                <option value="currency" <%= product.category === 'currency' ? 'selected' : '' %>>Digital Currency</option>
                <option value="other" <%= product.category === 'other' ? 'selected' : '' %>>Other</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="price">Price ($)</label>
              <input type="number" id="price" name="price" step="0.01" min="0" value="<%= product.price %>" required>
            </div>
            
            <div class="form-group">
              <label for="stock">Stock</label>
              <input type="number" id="stock" name="stock" min="0" value="<%= product.stock %>" required>
            </div>
            
            <div class="form-group full-width">
              <label for="imageUrl">Image URL</label>
              <input type="url" id="imageUrl" name="imageUrl" value="<%= product.imageUrl %>" required>
              <div class="image-preview">
                <img src="<%= product.imageUrl %>" alt="<%= product.name %>">
              </div>
            </div>
            
            <div class="form-group full-width">
              <label for="description">Description</label>
              <textarea id="description" name="description" rows="5" required><%= product.description %></textarea>
            </div>
            
            <!-- Dynamic fields based on category -->
            <div id="giftcard-fields" class="category-fields form-group full-width" style="display: <%= product.category === 'giftcard' ? 'block' : 'none' %>;">
              <label for="codes">Gift Card Codes (one per line)</label>
              <textarea id="codes" name="codes" rows="5" placeholder="Enter each code on a new line"><% if (product.codes && product.codes.length > 0) { %><%= product.codes.map(code => code.code).join('\n') %><% } %></textarea>
              <p class="form-hint">Each code will be assigned to a customer upon purchase</p>
              
              <div class="code-status">
                <h4>Code Status:</h4>
                <p>Total codes: <%= product.codes ? product.codes.length : 0 %></p>
                <p>Used codes: <%= product.codes ? product.codes.filter(code => code.used).length : 0 %></p>
                <p>Available codes: <%= product.codes ? product.codes.filter(code => !code.used).length : 0 %></p>
              </div>
            </div>
            
            <div id="account-fields" class="category-fields form-group full-width" style="display: <%= product.category === 'account' ? 'block' : 'none' %>;">
              <label for="accounts">Accounts (username:password, one per line)</label>
              <textarea id="accounts" name="accounts" rows="5" placeholder="username:password"><% if (product.accounts && product.accounts.length > 0) { %><%= product.accounts.map(acc => `${acc.username}:${acc.password}`).join('\n') %><% } %></textarea>
              <p class="form-hint">Format: username:password (one account per line)</p>
              
              <div class="account-status">
                <h4>Account Status:</h4>
                <p>Total accounts: <%= product.accounts ? product.accounts.length : 0 %></p>
                <p>Used accounts: <%= product.accounts ? product.accounts.filter(acc => acc.used).length : 0 %></p>
                <p>Available accounts: <%= product.accounts ? product.accounts.filter(acc => !acc.used).length : 0 %></p>
              </div>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Update Product</button>
            <a href="/admin/products" class="btn btn-outline">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </section>
  
  <script>
    // Show/hide fields based on category selection
    document.getElementById('category').addEventListener('change', function() {
      const category = this.value;
      const categoryFields = document.querySelectorAll('.category-fields');
      
      // Hide all category-specific fields
      categoryFields.forEach(field => {
        field.style.display = 'none';
      });
      
      // Show fields based on selected category
      if (category === 'giftcard') {
        document.getElementById('giftcard-fields').style.display = 'block';
      } else if (category === 'account') {
        document.getElementById('account-fields').style.display = 'block';
      }
    });
  </script>