<!-- views/user/orders.ejs -->
<section class="orders-page">
  <div class="container">
    <div class="page-header">
      <h1>Your Orders</h1>
    </div>
    
    <% if (orders.length === 0) { %>
      <div class="empty-orders">
        <div class="empty-icon">
          <i class="fas fa-shopping-bag"></i>
        </div>
        <h2>No orders yet</h2>
        <p>You haven't placed any orders yet.</p>
        <a href="/products" class="btn btn-primary">Start Shopping</a>
      </div>
    <% } else { %>
      <div class="orders-list">
        <% orders.forEach(order => { %>
          <div class="order-card">
            <div class="order-header">
              <div>
                <h3>Order #<%= order._id.toString().substring(0, 8) %>...</h3>
                <p class="order-date">Placed on <%= new Date(order.createdAt).toLocaleString() %></p>
              </div>
              <div class="order-status">
                <span class="status-badge <%= order.status %>">
                  <%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %>
                </span>
              </div>
            </div>
            
            <div class="order-items">
              <% order.products.forEach(item => { %>
                <div class="order-item">
                  <div class="item-image">
                    <% if (item.product) { %>
                      <img src="<%= item.product.imageUrl %>" alt="<%= item.product.name %>">
                    <% } else { %>
                      <div class="missing-product">Product Unavailable</div>
                    <% } %>
                  </div>
                  <div class="item-details">
                    <% if (item.product) { %>
                      <h4><%= item.product.name %></h4>
                      <p class="product-category">
                        <% if (item.product.category === 'giftcard') { %>
                          Gift Card
                        <% } else if (item.product.category === 'gameaccount') { %>
                          Game Account
                        <% } else if (item.product.category === 'currency') { %>
                          Digital Currency
                        <% } else { %>
                          Other
                        <% } %>
                      </p>
                    <% } else { %>
                      <h4>Product No Longer Available</h4>
                    <% } %>
                    <p>Quantity: <%= item.quantity %></p>
                    <p>Price: $<%= item.price.toFixed(2) %></p>
                  </div>
                </div>
              <% }); %>
            </div>
            
            <div class="order-footer">
              <div class="order-total">
                <p>Total: <strong>$<%= order.totalAmount.toFixed(2) %></strong></p>
              </div>
              <a href="/orders/<%= order._id %>" class="btn btn-outline">View Details</a>
            </div>
          </div>
        <% }); %>
      </div>
    <% } %>
  </div>
</section>

<style>
  .missing-product {
    width: 80px;
    height: 80px;
    background-color: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 0.8rem;
    color: var(--accent-color);
    border-radius: 4px;
  }
</style>