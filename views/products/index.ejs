<!-- views/products/index.ejs -->
<section class="product-listing">
  <div class="container">
    <div class="page-header">
      <h1>
        <% if (currentCategory === 'all') { %>
          All Products
        <% } else if (currentCategory === 'giftcard') { %>
          Gift Cards
        <% } else if (currentCategory === 'account') { %>
          Accounts
        <% } else if (currentCategory === 'currency') { %>
          Digital Currency
        <% } else if (currentCategory === 'other') { %>
          Other Digital Products
        <% } %>
        
        <% if (searchTerm) { %>
          Search results for "<%= searchTerm %>"
        <% } %>
      </h1>
    </div>
    
    <div class="product-filters">
      <div class="filter-categories">
        <a href="/products" class="<%= currentCategory === 'all' ? 'active' : '' %>">All</a>
        <a href="/products?category=giftcard" class="<%= currentCategory === 'giftcard' ? 'active' : '' %>">Gift Cards</a>
        <a href="/products?category=account" class="<%= currentCategory === 'account' ? 'active' : '' %>">Accounts</a>
        <a href="/products?category=currency" class="<%= currentCategory === 'currency' ? 'active' : '' %>">Digital Currency</a>
        <a href="/products?category=other" class="<%= currentCategory === 'other' ? 'active' : '' %>">Other</a>
      </div>
      
      <div class="filter-sort">
        <select name="sort" id="sort-products">
          <option value="newest">Newest</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
        </select>
      </div>
    </div>
    
    <% if (products.length === 0) { %>
      <div class="no-products">
        <p>No products found. Please try a different search or category.</p>
        <a href="/products" class="btn btn-primary">View All Products</a>
      </div>
    <% } else { %>
      <div class="product-grid">
        <% products.forEach(product => { %>
          <div class="product-card">
            <div class="product-image">
              <img src="<%= product.imageUrl %>" alt="<%= product.name %>">
              <% if (product.stock < 5 && product.stock > 0) { %>
                <span class="product-badge low-stock">Only <%= product.stock %> left!</span>
              <% } else if (product.stock === 0) { %>
                <span class="product-badge out-of-stock">Out of Stock</span>
              <% } %>
            </div>
            <div class="product-info">
              <h3 class="product-title ellipsis"><%= product.name %></h3>
              <p class="product-price">$<%= product.price.toFixed(2) %></p>
              <div class="product-actions">
                <a href="/products/<%= product._id %>" class="btn btn-outline btn-sm">View Details</a>
                <% if (product.stock > 0) { %>
                  <form action="/cart/add" method="POST">
                    <input type="hidden" name="productId" value="<%= product._id %>">
                    <input type="hidden" name="quantity" value="1">
                    <button type="submit" class="btn btn-primary btn-sm">Add to Cart</button>
                  </form>
                <% } else { %>
                  <button class="btn btn-disabled btn-sm" disabled>Out of Stock</button>
                <% } %>
              </div>
            </div>
          </div>
        <% }); %>
      </div>
    <% } %>
  </div>
</section>